<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kallakriti - Admin Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Poppins', sans-serif;
    background: #f5f5f5;
    color: #333;
}

/* Header */
.admin-header {
    background: linear-gradient(135deg, #1f2a44, #2f4670);
    color: white;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.admin-header h1 {
    font-size: 24px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.admin-info {
    display: flex;
    align-items: center;
    gap: 20px;
}

.logout-btn {
    background: #e74c3c;
    color: white;
    border: none;
    padding: 8px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 500;
    transition: background 0.3s;
}

.logout-btn:hover {
    background: #c0392b;
}

/* Dashboard Container */
.dashboard-container {
    display: flex;
    min-height: calc(100vh - 80px);
}

/* Sidebar */
.sidebar {
    width: 250px;
    background: white;
    box-shadow: 2px 0 10px rgba(0,0,0,0.05);
    padding: 20px 0;
}

.sidebar-menu {
    list-style: none;
}

.sidebar-menu li {
    padding: 15px 25px;
    cursor: pointer;
    transition: background 0.3s;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 500;
}

.sidebar-menu li:hover {
    background: #f8f4eb;
}

.sidebar-menu li.active {
    background: #9c7c38;
    color: white;
}

/* Main Content */
.main-content {
    flex: 1;
    padding: 30px;
    overflow-y: auto;
}

.section {
    background: white;
    border-radius: 10px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    display: none;
}

.section.active {
    display: block;
}

.section h2 {
    color: #1f2a44;
    margin-bottom: 25px;
    padding-bottom: 10px;
    border-bottom: 2px solid #f0f0f0;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Enhanced Materials Section */
.materials-section {
    background: #f9f9f9;
    padding: 25px;
    border-radius: 10px;
    margin-bottom: 25px;
}

/* Search and Filter Bar */
.search-filter-bar {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
    flex-wrap: wrap;
}

.search-box {
    flex: 1;
    min-width: 250px;
    position: relative;
}

.search-box input {
    width: 100%;
    padding: 12px 45px 12px 15px;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 14px;
    font-family: 'Poppins', sans-serif;
}

.search-box i {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #999;
}

.filter-dropdown select {
    padding: 12px 15px;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 14px;
    font-family: 'Poppins', sans-serif;
    background: white;
    min-width: 150px;
}

/* Materials Grid */
.materials-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.material-card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    border-left: 4px solid;
    position: relative;
    transition: transform 0.3s, box-shadow 0.3s;
}

.material-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.material-color {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    border: 2px solid #eee;
    margin-bottom: 10px;
}

.material-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
}

.material-name {
    font-weight: 600;
    color: #1f2a44;
    font-size: 16px;
    margin-bottom: 5px;
}

.material-type {
    font-size: 12px;
    color: #666;
    background: #f0f0f0;
    padding: 3px 8px;
    border-radius: 12px;
}

.material-details {
    margin: 15px 0;
}

.material-details p {
    margin-bottom: 8px;
    font-size: 14px;
    display: flex;
    justify-content: space-between;
}

.material-details .label {
    color: #666;
}

.stock-level {
    display: inline-block;
    padding: 5px 12px;
    border-radius: 15px;
    font-size: 12px;
    font-weight: 500;
}

.stock-high { background: #d4edda; color: #155724; }
.stock-medium { background: #fff3cd; color: #856404; }
.stock-low { background: #f8d7da; color: #721c24; }

.material-actions {
    display: flex;
    gap: 8px;
    margin-top: 15px;
}

.material-btn {
    padding: 8px 12px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: all 0.2s;
}

.edit-material-btn {
    background: #3498db;
    color: white;
}

.edit-material-btn:hover {
    background: #2980b9;
}

.delete-material-btn {
    background: #e74c3c;
    color: white;
}

.delete-material-btn:hover {
    background: #c0392b;
}

.use-material-btn {
    background: #2ecc71;
    color: white;
}

.use-material-btn:hover {
    background: #27ae60;
}

/* Stock Summary */
.stock-summary {
    background: white;
    border-radius: 10px;
    padding: 20px;
    margin-top: 30px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.05);
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.summary-item {
    text-align: center;
    padding: 15px;
    border-radius: 8px;
    background: #f8f9fa;
}

.summary-value {
    font-size: 28px;
    font-weight: 600;
    margin-bottom: 5px;
}

.summary-high { color: #2ecc71; }
.summary-medium { color: #f39c12; }
.summary-low { color: #e74c3c; }

/* Add Material Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    justify-content: center;
    align-items: center;
}

.modal-content {
    background: white;
    width: 90%;
    max-width: 500px;
    border-radius: 10px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.modal-header h3 {
    color: #1f2a44;
    font-size: 20px;
}

.close-modal {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #666;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #333;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 14px;
    font-family: 'Poppins', sans-serif;
    transition: border-color 0.3s;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #9c7c38;
}

.color-picker {
    display: flex;
    align-items: center;
    gap: 10px;
}

.color-picker input {
    width: 60px;
    height: 40px;
    padding: 0;
    border: 2px solid #ddd;
    border-radius: 6px;
    cursor: pointer;
}

/* Auto-save indicator */
.auto-save-indicator {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #2ecc71;
    color: white;
    padding: 10px 15px;
    border-radius: 5px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    display: flex;
    align-items: center;
    gap: 8px;
    z-index: 1001;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.3s, transform 0.3s;
}

.auto-save-indicator.show {
    opacity: 1;
    transform: translateY(0);
}

/* Manual Save Button */
.save-changes-btn {
    background: #9c7c38;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: background 0.3s;
}

.save-changes-btn:hover {
    background: #7a612d;
}

.save-changes-btn.saving {
    background: #3498db;
}

/* Data Management Controls */
.data-management {
    background: white;
    border-radius: 10px;
    padding: 20px;
    margin-top: 30px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.05);
}

.data-management h3 {
    color: #1f2a44;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.data-controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.data-control-btn {
    padding: 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
}

.data-control-btn.backup {
    background: #3498db;
    color: white;
}

.data-control-btn.backup:hover {
    background: #2980b9;
}

.data-control-btn.restore {
    background: #2ecc71;
    color: white;
}

.data-control-btn.restore:hover {
    background: #27ae60;
}

.data-control-btn.reset {
    background: #e74c3c;
    color: white;
}

.data-control-btn.reset:hover {
    background: #c0392b;
}

/* Last Saved Info */
.last-saved-info {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin-top: 20px;
    font-size: 13px;
    color: #666;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.last-saved-info .time {
    font-weight: 500;
    color: #2ecc71;
}

/* Responsive */
@media (max-width: 768px) {
    .dashboard-container {
        flex-direction: column;
    }
    
    .sidebar {
        width: 100%;
        order: 2;
    }
    
    .sidebar-menu {
        display: flex;
        overflow-x: auto;
    }
    
    .sidebar-menu li {
        white-space: nowrap;
    }
    
    .materials-grid {
        grid-template-columns: 1fr;
    }
    
    .search-filter-bar {
        flex-direction: column;
    }
    
    .search-box {
        min-width: 100%;
    }
    
    .data-controls {
        grid-template-columns: 1fr;
    }
}

/* Other existing styles remain the same */
.product-form { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; background: #f9f9f9; padding: 25px; border-radius: 10px; }
.form-buttons { grid-column: 1 / -1; display: flex; gap: 15px; }
.btn { padding: 12px 30px; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 14px; transition: all 0.3s; display: flex; align-items: center; gap: 8px; }
.btn-primary { background: #9c7c38; color: white; }
.btn-primary:hover { background: #7a612d; }
.btn-secondary { background: #3498db; color: white; }
.btn-secondary:hover { background: #2980b9; }
.btn-danger { background: #e74c3c; color: white; }
.btn-danger:hover { background: #c0392b; }
.btn-success { background: #2ecc71; color: white; }
.btn-success:hover { background: #27ae60; }
.products-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
.products-table th { background: #f8f4eb; padding: 15px; text-align: left; font-weight: 600; color: #1f2a44; border-bottom: 2px solid #e0d6c2; }
.products-table td { padding: 15px; border-bottom: 1px solid #eee; }
.product-image { width: 60px; height: 60px; object-fit: cover; border-radius: 6px; }
.action-buttons { display: flex; gap: 10px; }
.action-btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 500; }
.edit-btn { background: #3498db; color: white; }
.delete-btn { background: #e74c3c; color: white; }
.complaints-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
.complaints-table th { background: #f8f4eb; padding: 15px; text-align: left; font-weight: 600; color: #1f2a44; border-bottom: 2px solid #e0d6c2; }
.complaints-table td { padding: 15px; border-bottom: 1px solid #eee; }
.status-badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; }
.status-pending { background: #fff3cd; color: #856404; }
.status-resolved { background: #d4edda; color: #155724; }
.image-preview { width: 150px; height: 150px; border: 2px dashed #ddd; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; overflow: hidden; }
.image-preview img { max-width: 100%; max-height: 100%; display: none; }
.image-preview span { color: #999; font-size: 14px; }
.design-ideas-section { background: #f9f9f9; padding: 25px; border-radius: 10px; margin-bottom: 25px; }
.ideas-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
.idea-item { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
.idea-item h4 { color: #1f2a44; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
.idea-item img { width: 100%; height: 120px; object-fit: cover; border-radius: 6px; margin-bottom: 10px; }
.password-form { max-width: 500px; margin: 0 auto; background: #f9f9f9; padding: 25px; border-radius: 10px; }
.password-strength { height: 5px; background: #ddd; border-radius: 3px; margin-top: 5px; overflow: hidden; }
.strength-bar { height: 100%; width: 0%; transition: width 0.3s, background 0.3s; }
.strength-weak { background: #e74c3c; width: 33%; }
.strength-medium { background: #f39c12; width: 66%; }
.strength-strong { background: #2ecc71; width: 100%; }
.password-requirements { background: #fff3cd; padding: 15px; border-radius: 6px; margin-top: 20px; font-size: 13px; }
.password-requirements ul { margin-left: 20px; margin-top: 10px; }
.alert { padding: 15px; border-radius: 6px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
.alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
.alert-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
.quick-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 30px 0; }
.action-card { background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: 0 4px 8px rgba(0,0,0,0.05); cursor: pointer; transition: all 0.3s; }
.action-card:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
.action-card i { font-size: 30px; margin-bottom: 10px; color: #9c7c38; }
.business-tools { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 30px; }
.tool-card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); transition: transform 0.3s; }
.tool-card:hover { transform: translateY(-5px); }
.tool-card i { font-size: 40px; color: #9c7c38; margin-bottom: 15px; }
.tool-card h3 { color: #1f2a44; margin-bottom: 10px; }
.tool-card p { color: #666; font-size: 14px; margin-bottom: 20px; }
</style>
</head>
<body>
    <!-- Header -->
    <div class="admin-header">
        <h1><i class="fas fa-crown"></i> Kallakriti Admin Dashboard</h1>
        <div class="admin-info">
            <span><i class="fas fa-user-circle"></i> Admin</span>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </div>

    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <ul class="sidebar-menu">
                <li class="active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </li>
                <li onclick="showSection('products')">
                    <i class="fas fa-box"></i> Product Management
                </li>
                <li onclick="showSection('addProduct')">
                    <i class="fas fa-plus-circle"></i> Add New Product
                </li>
                <li onclick="showSection('complaints')">
                    <i class="fas fa-exclamation-triangle"></i> Customer Complaints
                </li>
                <li onclick="showSection('materials')">
                    <i class="fas fa-spool"></i> Materials Stock
                </li>
                <li onclick="showSection('designs')">
                    <i class="fas fa-palette"></i> Design Ideas
                </li>
                <li onclick="showSection('password')">
                    <i class="fas fa-key"></i> Change Password
                </li>
                <li onclick="showSection('settings')">
                    <i class="fas fa-cog"></i> Settings
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboard" class="section active">
                <h2><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h2>
                
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card products">
                        <i class="fas fa-box"></i>
                        <div class="stat-number" id="totalProducts">0</div>
                        <div class="stat-label">Active Products</div>
                    </div>
                    
                    <div class="stat-card complaints">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div class="stat-number" id="totalComplaints">0</div>
                        <div class="stat-label">Pending Complaints</div>
                    </div>
                    
                    <div class="stat-card materials">
                        <i class="fas fa-spool"></i>
                        <div class="stat-number" id="materialStock">12</div>
                        <div class="stat-label">Yarn Colors</div>
                    </div>
                    
                    <div class="stat-card custom">
                        <i class="fas fa-star"></i>
                        <div class="stat-number" id="customOrders">5</div>
                        <div class="stat-label">Custom Orders</div>
                    </div>
                </div>

                <!-- Materials Low Stock Alert -->
                <div id="lowStockAlert" class="alert alert-info" style="display: none;">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="lowStockMessage"></span>
                </div>

                <!-- Data Status -->
                <div class="last-saved-info" style="margin-top: 30px;">
                    <div>
                        <i class="fas fa-database"></i>
                        <span>Materials Data Status: <span class="time" id="dataStatus">Loading...</span></span>
                    </div>
                    <button class="save-changes-btn" onclick="saveMaterialsData()" id="saveChangesBtn">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>

                <!-- Quick Actions -->
                <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                <div class="quick-actions">
                    <div class="action-card" onclick="showSection('addProduct')">
                        <i class="fas fa-plus"></i>
                        <div>Add Product</div>
                    </div>
                    <div class="action-card" onclick="showSection('materials')">
                        <i class="fas fa-spool"></i>
                        <div>Check Stock</div>
                    </div>
                    <div class="action-card" onclick="showSection('complaints')">
                        <i class="fas fa-comments"></i>
                        <div>View Complaints</div>
                    </div>
                    <div class="action-card" onclick="backupData()">
                        <i class="fas fa-save"></i>
                        <div>Backup Data</div>
                    </div>
                </div>
            </div>

            <!-- Materials Stock Section (Enhanced) -->
            <div id="materials" class="section">
                <h2><i class="fas fa-spool"></i> Materials Stock Management</h2>
                <p>Track and manage your crochet materials inventory. All changes are automatically saved.</p>
                
                <!-- Data Status Bar -->
                <div class="last-saved-info" style="margin-bottom: 20px;">
                    <div>
                        <i class="fas fa-clock"></i>
                        <span>Last saved: <span class="time" id="lastSavedTime">Never</span></span>
                    </div>
                    <div>
                        <i class="fas fa-database"></i>
                        <span>Items: <span id="materialCount">0</span> | Auto-save: <span id="autoSaveStatus">ON</span></span>
                    </div>
                </div>

                <!-- Search and Filter Bar -->
                <div class="search-filter-bar">
                    <div class="search-box">
                        <input type="text" id="searchMaterials" placeholder="Search materials by name or type..." onkeyup="searchMaterials()">
                        <i class="fas fa-search"></i>
                    </div>
                    
                    <div class="filter-dropdown">
                        <select id="filterStock" onchange="filterMaterials()">
                            <option value="all">All Stock Levels</option>
                            <option value="high">High Stock</option>
                            <option value="medium">Medium Stock</option>
                            <option value="low">Low Stock</option>
                        </select>
                    </div>
                    
                    <div class="filter-dropdown">
                        <select id="filterType" onchange="filterMaterials()">
                            <option value="all">All Types</option>
                            <option value="yarn">Yarn</option>
                            <option value="thread">Thread</option>
                            <option value="accessory">Accessory</option>
                            <option value="material">Material</option>
                            <option value="tool">Tool</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-success" onclick="openAddMaterialModal()">
                        <i class="fas fa-plus"></i> Add New Material
                    </button>
                    
                    <button class="save-changes-btn" onclick="saveMaterialsData()">
                        <i class="fas fa-save"></i> Save Now
                    </button>
                </div>

                <!-- Materials Grid -->
                <div class="materials-grid" id="materialsGrid">
                    <!-- Materials will be loaded here dynamically -->
                </div>

                <!-- Stock Summary -->
                <div class="stock-summary">
                    <h3><i class="fas fa-chart-pie"></i> Stock Summary</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-value summary-high" id="highStockCount">0</div>
                            <div>High Stock Items</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value summary-medium" id="mediumStockCount">0</div>
                            <div>Medium Stock Items</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value summary-low" id="lowStockCount">0</div>
                            <div>Low Stock Items</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value" id="totalMaterialsCount">0</div>
                            <div>Total Items</div>
                        </div>
                    </div>
                </div>

                <!-- Data Management -->
                <div class="data-management">
                    <h3><i class="fas fa-database"></i> Data Management</h3>
                    <p>Manage your materials data. All changes are saved automatically to your browser's local storage.</p>
                    
                    <div class="data-controls">
                        <button class="data-control-btn backup" onclick="backupMaterialsData()">
                            <i class="fas fa-file-export"></i> Backup Materials Data
                        </button>
                        <button class="data-control-btn restore" onclick="restoreMaterialsData()">
                            <i class="fas fa-file-import"></i> Restore from Backup
                        </button>
                        <button class="data-control-btn reset" onclick="resetMaterialsData()">
                            <i class="fas fa-redo"></i> Reset to Default
                        </button>
                    </div>
                    
                    <div class="last-saved-info" style="margin-top: 20px;">
                        <div>
                            <i class="fas fa-info-circle"></i>
                            <span>Data is stored locally in your browser. It will persist even after logout.</span>
                        </div>
                        <div>
                            <i class="fas fa-shield-alt"></i>
                            <span>Last backup: <span id="lastBackupTime">Never</span></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other sections (products, addProduct, complaints, designs, password, settings) -->
            <!-- [These sections remain exactly the same as in the previous code] -->
            <!-- Product Management Section -->
            <div id="products" class="section">
                <h2><i class="fas fa-box"></i> Product Management</h2>
                <p>Edit or delete existing products. Click "Edit" to modify product details.</p>
                
                <div class="products-table-container">
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Products will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Add Product Section -->
            <div id="addProduct" class="section">
                <h2><i class="fas fa-plus-circle"></i> Add New Product</h2>
                
                <form id="addProductForm" class="product-form" onsubmit="addNewProduct(event)">
                    <div class="form-group">
                        <label for="productName">Product Name *</label>
                        <input type="text" id="productName" required placeholder="e.g., Crochet Rose Bouquet">
                    </div>
                    
                    <div class="form-group">
                        <label for="productPrice">Price (‚Çπ) *</label>
                        <input type="number" id="productPrice" required placeholder="e.g., 299" min="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="productCategory">Category *</label>
                        <select id="productCategory" required>
                            <option value="">Select Category</option>
                            <option value="flowers">Crochet Flowers</option>
                            <option value="toys">Crochet Toys</option>
                            <option value="accessories">Accessories</option>
                            <option value="baby">Baby Items</option>
                            <option value="custom">Custom Orders</option>
                            <option value="money">Money Bouquets</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="productImageUrl">Image URL</label>
                        <input type="url" id="productImageUrl" placeholder="https://example.com/image.jpg">
                    </div>
                    
                    <div class="form-group full-width">
                        <label>Image Preview</label>
                        <div class="image-preview" id="imagePreview">
                            <span>Preview will appear here</span>
                            <img id="previewImage" src="" alt="Preview">
                        </div>
                        <small>You can use free image hosting services like ImgBB or Unsplash for images</small>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Add Product
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()">
                            <i class="fas fa-redo"></i> Clear Form
                        </button>
                    </div>
                </form>
            </div>

            <!-- Complaints Section -->
            <div id="complaints" class="section">
                <h2><i class="fas fa-exclamation-triangle"></i> Customer Complaints</h2>
                
                <div class="complaints-table-container">
                    <table class="complaints-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Phone</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="complaintsTableBody">
                            <!-- Complaints will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Design Ideas Section -->
            <div id="designs" class="section">
                <h2><i class="fas fa-palette"></i> Design Ideas & Inspiration</h2>
                <p>Save and organize your crochet design ideas and patterns.</p>
                
                <div class="design-ideas-section">
                    <h3><i class="fas fa-lightbulb"></i> Design Collection</h3>
                    <div class="ideas-list" id="ideasList">
                        <!-- Design ideas will be loaded here -->
                    </div>
                    
                    <div class="form-buttons" style="margin-top: 20px;">
                        <button class="btn btn-success" onclick="addNewDesign()">
                            <i class="fas fa-plus"></i> Add New Design Idea
                        </button>
                        <button class="btn btn-secondary" onclick="importDesigns()">
                            <i class="fas fa-download"></i> Import Patterns
                        </button>
                    </div>
                </div>
            </div>

            <!-- Change Password Section -->
            <div id="password" class="section">
                <h2><i class="fas fa-key"></i> Change Admin Password</h2>
                <p>Update your admin login password for security.</p>
                
                <div class="password-form">
                    <form id="changePasswordForm" onsubmit="changeAdminPassword(event)">
                        <div class="form-group">
                            <label for="currentPassword">Current Password *</label>
                            <input type="password" id="currentPassword" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="newPassword">New Password *</label>
                            <input type="password" id="newPassword" required oninput="checkPasswordStrength()">
                            <div class="password-strength">
                                <div class="strength-bar" id="passwordStrength"></div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmPassword">Confirm New Password *</label>
                            <input type="password" id="confirmPassword" required>
                        </div>
                        
                        <div class="password-requirements">
                            <strong>Password Requirements:</strong>
                            <ul>
                                <li>At least 8 characters long</li>
                                <li>Contains uppercase and lowercase letters</li>
                                <li>Includes at least one number</li>
                                <li>Includes at least one special character</li>
                            </ul>
                        </div>
                        
                        <div class="form-buttons">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-key"></i> Change Password
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="clearPasswordForm()">
                                <i class="fas fa-redo"></i> Clear
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings" class="section">
                <h2><i class="fas fa-cog"></i> Business Settings</h2>
                
                <div class="product-form">
                    <div class="form-group">
                        <label for="whatsappNumber">WhatsApp Number *</label>
                        <input type="tel" id="whatsappNumber" value="7002341920" required>
                        <small>When you change this, customer website will update automatically</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="adminEmail">Business Email *</label>
                        <input type="email" id="adminEmail" value="kallakriti.craft@gmail.com" required>
                        <small>This email will show on customer website footer</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="businessHours">Business Hours</label>
                        <input type="text" id="businessHours" value="10:00 AM - 7:00 PM">
                    </div>
                    
                    <div class="form-group">
                        <label for="deliveryTime">Delivery Time Estimate</label>
                        <input type="text" id="deliveryTime" value="3-7 days for ready items">
                    </div>
                    
                    <div class="form-buttons">
                        <button class="btn btn-primary" onclick="saveSettings()">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                        <button class="btn btn-secondary" onclick="resetSettings()">
                            <i class="fas fa-redo"></i> Reset to Default
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Material Modal -->
    <div id="addMaterialModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus"></i> Add New Material</h3>
                <button class="close-modal" onclick="closeAddMaterialModal()">&times;</button>
            </div>
            
            <form id="materialForm" onsubmit="saveMaterial(event)">
                <div class="form-group">
                    <label for="materialName">Material Name *</label>
                    <input type="text" id="materialName" required placeholder="e.g., Cotton Yarn - White">
                </div>
                
                <div class="form-group">
                    <label for="materialType">Material Type *</label>
                    <select id="materialType" required>
                        <option value="">Select Type</option>
                        <option value="yarn">Yarn</option>
                        <option value="thread">Thread</option>
                        <option value="accessory">Accessory (Eyes, Buttons, etc.)</option>
                        <option value="material">Material (Polyfill, Fabric)</option>
                        <option value="tool">Tool (Hook, Scissors, etc.)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="materialColor">Color *</label>
                    <div class="color-picker">
                        <input type="color" id="materialColor" value="#ffffff">
                        <input type="text" id="materialColorText" placeholder="Color name or hex" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="materialStock">Stock Level *</label>
                    <select id="materialStock" required>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="materialQuantity">Quantity (optional)</label>
                    <input type="text" id="materialQuantity" placeholder="e.g., 5 balls, 100g, 2 packs">
                </div>
                
                <div class="form-group">
                    <label for="materialNotes">Notes (optional)</label>
                    <textarea id="materialNotes" rows="3" placeholder="Any additional notes about this material"></textarea>
                </div>
                
                <div class="form-buttons">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Material
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeAddMaterialModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Auto-save Indicator -->
    <div id="autoSaveIndicator" class="auto-save-indicator">
        <i class="fas fa-check-circle"></i>
        <span>Changes saved!</span>
    </div>

    <script>
    // ============= PERSISTENT MATERIALS STORAGE =============
    
    // Materials data structure - Now loaded from localStorage
    let materials = [];
    let editingMaterialIndex = -1;
    let autoSaveEnabled = true;
    let lastSaveTime = null;
    let changeDetected = false;

    // Initialize materials from localStorage
    function initializeMaterials() {
        const savedMaterials = localStorage.getItem('kallakritiMaterials');
        
        if (savedMaterials) {
            try {
                materials = JSON.parse(savedMaterials);
                showAlert('‚úÖ Materials loaded from saved data!', 'success');
                updateLastSavedTime();
            } catch (e) {
                console.error('Error loading materials:', e);
                loadDefaultMaterials();
            }
        } else {
            // Load default materials if nothing is saved
            loadDefaultMaterials();
        }
        
        // Load last backup time
        const lastBackup = localStorage.getItem('kallakritiLastBackup');
        if (lastBackup) {
            document.getElementById('lastBackupTime').textContent = formatTime(new Date(lastBackup));
        }
        
        updateDataStatus();
    }

    // Load default materials
    function loadDefaultMaterials() {
        materials = [
            {name: "Cotton Yarn - White", type: "yarn", color: "#FFFFFF", stock: "high", quantity: "10 balls", notes: "Good for amigurumi", lastUpdated: new Date().toISOString()},
            {name: "Acrylic Yarn - Red", type: "yarn", color: "#FF0000", stock: "medium", quantity: "5 balls", notes: "For festive items", lastUpdated: new Date().toISOString()},
            {name: "Wool Blend - Beige", type: "yarn", color: "#F5F5DC", stock: "low", quantity: "2 balls", notes: "Almost finished", lastUpdated: new Date().toISOString()},
            {name: "Metallic Thread - Gold", type: "thread", color: "#FFD700", stock: "medium", quantity: "3 spools", lastUpdated: new Date().toISOString()},
            {name: "Safety Eyes - 10mm", type: "accessory", color: "#000000", stock: "high", quantity: "50 pairs", lastUpdated: new Date().toISOString()},
            {name: "Polyfill Stuffing", type: "material", color: "#FFFFFF", stock: "high", quantity: "2 kg", lastUpdated: new Date().toISOString()},
            {name: "Crochet Hook - 3.5mm", type: "tool", color: "#C0C0C0", stock: "medium", quantity: "3 pieces", lastUpdated: new Date().toISOString()},
            {name: "Chenille Yarn - Pink", type: "yarn", color: "#FFC0CB", stock: "medium", quantity: "4 balls", notes: "For baby items", lastUpdated: new Date().toISOString()},
            {name: "Buttons - Assorted", type: "accessory", color: "#8B4513", stock: "low", quantity: "15 pieces", lastUpdated: new Date().toISOString()},
            {name: "Jute Twine", type: "yarn", color: "#D2B48C", stock: "high", quantity: "2 rolls", lastUpdated: new Date().toISOString()}
        ];
        
        saveMaterialsToStorage();
        showAlert('üìù Loaded default materials. Changes will be saved automatically.', 'info');
    }

    // Save materials to localStorage
    function saveMaterialsToStorage() {
        try {
            // Add last updated timestamp to each material
            const timestamp = new Date().toISOString();
            materials.forEach(material => {
                material.lastUpdated = timestamp;
            });
            
            localStorage.setItem('kallakritiMaterials', JSON.stringify(materials));
            lastSaveTime = new Date();
            changeDetected = false;
            
            updateLastSavedTime();
            updateDataStatus();
            showAutoSaveIndicator();
            
            return true;
        } catch (e) {
            console.error('Error saving materials:', e);
            showAlert('‚ùå Error saving materials! Please try again.', 'error');
            return false;
        }
    }

    // Update last saved time display
    function updateLastSavedTime() {
        const lastSavedTimeEl = document.getElementById('lastSavedTime');
        const now = new Date();
        
        if (lastSaveTime) {
            const diff = Math.floor((now - lastSaveTime) / 1000);
            
            if (diff < 60) {
                lastSavedTimeEl.textContent = 'Just now';
            } else if (diff < 3600) {
                const minutes = Math.floor(diff / 60);
                lastSavedTimeEl.textContent = `${minutes} minute${minutes !== 1 ? 's' : ''} ago`;
            } else if (diff < 86400) {
                const hours = Math.floor(diff / 3600);
                lastSavedTimeEl.textContent = `${hours} hour${hours !== 1 ? 's' : ''} ago`;
            } else {
                lastSavedTimeEl.textContent = formatTime(lastSaveTime);
            }
        } else {
            lastSavedTimeEl.textContent = 'Never';
        }
        
        // Update material count
        document.getElementById('materialCount').textContent = materials.length;
    }

    // Format time for display
    function formatTime(date) {
        if (!date) return 'Never';
        
        const d = new Date(date);
        return d.toLocaleDateString() + ' ' + d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    }

    // Update data status
    function updateDataStatus() {
        const dataStatusEl = document.getElementById('dataStatus');
        const saveBtn = document.getElementById('saveChangesBtn');
        
        if (materials.length === 0) {
            dataStatusEl.textContent = 'No data';
            dataStatusEl.style.color = '#e74c3c';
            saveBtn.disabled = true;
        } else {
            dataStatusEl.textContent = 'Saved';
            dataStatusEl.style.color = '#2ecc71';
            saveBtn.disabled = false;
            
            if (changeDetected) {
                dataStatusEl.textContent = 'Unsaved changes';
                dataStatusEl.style.color = '#f39c12';
                saveBtn.innerHTML = '<i class="fas fa-exclamation-circle"></i> Save Changes';
            } else {
                saveBtn.innerHTML = '<i class="fas fa-save"></i> Save Changes';
            }
        }
    }

    // Show auto-save indicator
    function showAutoSaveIndicator() {
        const indicator = document.getElementById('autoSaveIndicator');
        indicator.classList.add('show');
        
        setTimeout(() => {
            indicator.classList.remove('show');
        }, 3000);
    }

    // Manual save function
    function saveMaterialsData() {
        const saveBtn = document.querySelector('.save-changes-btn');
        const originalText = saveBtn.innerHTML;
        
        saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        saveBtn.classList.add('saving');
        
        setTimeout(() => {
            if (saveMaterialsToStorage()) {
                saveBtn.innerHTML = '<i class="fas fa-check"></i> Saved!';
                showAlert('‚úÖ All changes saved successfully!', 'success');
            } else {
                saveBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error!';
            }
            
            setTimeout(() => {
                saveBtn.innerHTML = originalText;
                saveBtn.classList.remove('saving');
            }, 1500);
        }, 500);
    }

    // Backup materials data
    function backupMaterialsData() {
        const backup = {
            materials: materials,
            backupDate: new Date().toISOString(),
            itemCount: materials.length
        };
        
        localStorage.setItem('kallakritiMaterialsBackup', JSON.stringify(backup));
        localStorage.setItem('kallakritiLastBackup', new Date().toISOString());
        
        document.getElementById('lastBackupTime').textContent = formatTime(new Date());
        
        // Create downloadable backup file
        const dataStr = JSON.stringify(backup, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `kallakriti-materials-backup-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showAlert('‚úÖ Materials backup created and downloaded!', 'success');
    }

    // Restore materials from backup
    function restoreMaterialsData() {
        const backupData = localStorage.getItem('kallakritiMaterialsBackup');
        
        if (!backupData) {
            alert('‚ùå No backup found! Please create a backup first.');
            return;
        }
        
        if (confirm('‚ö†Ô∏è Restore materials from backup?\n\nThis will replace ALL current materials with the backup data.')) {
            try {
                const backup = JSON.parse(backupData);
                materials = backup.materials;
                saveMaterialsToStorage();
                loadMaterialsGrid();
                
                showAlert('‚úÖ Materials restored from backup!', 'success');
            } catch (e) {
                console.error('Error restoring backup:', e);
                showAlert('‚ùå Error restoring backup!', 'error');
            }
        }
    }

    // Reset materials to default
    function resetMaterialsData() {
        if (confirm('‚ö†Ô∏è Reset all materials to default?\n\nThis will DELETE ALL your current materials and load the default ones.')) {
            loadDefaultMaterials();
            loadMaterialsGrid();
            showAlert('‚úÖ Materials reset to default!', 'success');
        }
    }

    // Mark changes as detected
    function markChangesDetected() {
        if (!changeDetected) {
            changeDetected = true;
            updateDataStatus();
        }
    }

    // ============= MATERIALS MANAGEMENT FUNCTIONS =============
    
    // Load materials grid
    function loadMaterialsGrid() {
        const materialsGrid = document.getElementById('materialsGrid');
        materialsGrid.innerHTML = '';
        
        let filteredMaterials = [...materials];
        const searchTerm = document.getElementById('searchMaterials').value.toLowerCase();
        const stockFilter = document.getElementById('filterStock').value;
        const typeFilter = document.getElementById('filterType').value;
        
        // Apply search filter
        if (searchTerm) {
            filteredMaterials = filteredMaterials.filter(material => 
                material.name.toLowerCase().includes(searchTerm) ||
                material.type.toLowerCase().includes(searchTerm) ||
                (material.notes && material.notes.toLowerCase().includes(searchTerm))
            );
        }
        
        // Apply stock filter
        if (stockFilter !== 'all') {
            filteredMaterials = filteredMaterials.filter(material => 
                material.stock === stockFilter
            );
        }
        
        // Apply type filter
        if (typeFilter !== 'all') {
            filteredMaterials = filteredMaterials.filter(material => 
                material.type === typeFilter
            );
        }
        
        // Display message if no materials found
        if (filteredMaterials.length === 0) {
            materialsGrid.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #666;">
                    <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 15px;"></i>
                    <h3>No materials found</h3>
                    <p>Try a different search term or filter</p>
                </div>
            `;
            return;
        }
        
        // Create material cards
        filteredMaterials.forEach((material, index) => {
            const materialCard = document.createElement('div');
            materialCard.className = 'material-card';
            materialCard.style.borderLeftColor = material.color;
            
            const stockClass = `stock-${material.stock}`;
            const stockText = material.stock.charAt(0).toUpperCase() + material.stock.slice(1);
            
            materialCard.innerHTML = `
                <div class="material-header">
                    <div>
                        <div class="material-color" style="background-color: ${material.color}"></div>
                        <div class="material-name">${material.name}</div>
                        <span class="material-type">${getMaterialTypeName(material.type)}</span>
                    </div>
                    <span class="stock-level ${stockClass}">${stockText}</span>
                </div>
                
                <div class="material-details">
                    <p><span class="label">Color:</span> <span>${material.color}</span></p>
                    ${material.quantity ? `<p><span class="label">Quantity:</span> <span>${material.quantity}</span></p>` : ''}
                    ${material.notes ? `<p><span class="label">Notes:</span> <span>${material.notes}</span></p>` : ''}
                    ${material.lastUpdated ? `<p><span class="label">Updated:</span> <span style="font-size: 11px; color: #888;">${formatTime(new Date(material.lastUpdated))}</span></p>` : ''}
                </div>
                
                <div class="material-actions">
                    <button class="material-btn edit-material-btn" onclick="editMaterial(${index})">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="material-btn delete-material-btn" onclick="deleteMaterial(${index})">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                    <button class="material-btn use-material-btn" onclick="useMaterial(${index})">
                        <i class="fas fa-minus"></i> Use
                    </button>
                </div>
            `;
            
            materialsGrid.appendChild(materialCard);
        });
        
        updateStockSummary();
        checkLowStock();
    }

    // Get material type name
    function getMaterialTypeName(typeCode) {
        const types = {
            'yarn': 'Yarn',
            'thread': 'Thread',
            'accessory': 'Accessory',
            'material': 'Material',
            'tool': 'Tool'
        };
        return types[typeCode] || typeCode;
    }

    // Update stock summary
    function updateStockSummary() {
        const highStock = materials.filter(m => m.stock === 'high').length;
        const mediumStock = materials.filter(m => m.stock === 'medium').length;
        const lowStock = materials.filter(m => m.stock === 'low').length;
        const total = materials.length;
        
        document.getElementById('highStockCount').textContent = highStock;
        document.getElementById('mediumStockCount').textContent = mediumStock;
        document.getElementById('lowStockCount').textContent = lowStock;
        document.getElementById('totalMaterialsCount').textContent = total;
        
        // Update dashboard stat
        document.getElementById('materialStock').textContent = total;
    }

    // Check for low stock items
    function checkLowStock() {
        const lowStockItems = materials.filter(m => m.stock === 'low');
        const lowStockAlert = document.getElementById('lowStockAlert');
        const lowStockMessage = document.getElementById('lowStockMessage');
        
        if (lowStockItems.length > 0) {
            lowStockAlert.style.display = 'flex';
            lowStockMessage.textContent = `You have ${lowStockItems.length} items with low stock. Check the Materials section to reorder.`;
        } else {
            lowStockAlert.style.display = 'none';
        }
    }

    // Search materials
    function searchMaterials() {
        loadMaterialsGrid();
    }

    // Filter materials
    function filterMaterials() {
        loadMaterialsGrid();
    }

    // Open add material modal
    function openAddMaterialModal(editIndex = -1) {
        const modal = document.getElementById('addMaterialModal');
        const form = document.getElementById('materialForm');
        const modalTitle = modal.querySelector('h3');
        const submitBtn = form.querySelector('button[type="submit"]');
        
        editingMaterialIndex = editIndex;
        
        if (editIndex >= 0) {
            // Edit mode
            modalTitle.innerHTML = '<i class="fas fa-edit"></i> Edit Material';
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Material';
            
            const material = materials[editIndex];
            document.getElementById('materialName').value = material.name;
            document.getElementById('materialType').value = material.type;
            document.getElementById('materialColor').value = material.color;
            document.getElementById('materialColorText').value = material.color;
            document.getElementById('materialStock').value = material.stock;
            document.getElementById('materialQuantity').value = material.quantity || '';
            document.getElementById('materialNotes').value = material.notes || '';
        } else {
            // Add mode
            modalTitle.innerHTML = '<i class="fas fa-plus"></i> Add New Material';
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Save Material';
            form.reset();
            document.getElementById('materialColor').value = '#ffffff';
            document.getElementById('materialColorText').value = '#ffffff';
        }
        
        modal.style.display = 'flex';
    }

    // Close add material modal
    function closeAddMaterialModal() {
        document.getElementById('addMaterialModal').style.display = 'none';
        editingMaterialIndex = -1;
    }

    // Save material
    function saveMaterial(event) {
        event.preventDefault();
        
        const newMaterial = {
            name: document.getElementById('materialName').value,
            type: document.getElementById('materialType').value,
            color: document.getElementById('materialColorText').value,
            stock: document.getElementById('materialStock').value,
            quantity: document.getElementById('materialQuantity').value || '',
            notes: document.getElementById('materialNotes').value || '',
            lastUpdated: new Date().toISOString()
        };
        
        if (editingMaterialIndex >= 0) {
            // Update existing material
            materials[editingMaterialIndex] = newMaterial;
        } else {
            // Add new material
            materials.push(newMaterial);
        }
        
        markChangesDetected();
        saveMaterialsToStorage();
        closeAddMaterialModal();
        loadMaterialsGrid();
        
        showAlert('‚úÖ Material saved successfully!', 'success');
    }

    // Edit material
    function editMaterial(index) {
        openAddMaterialModal(index);
    }

    // Delete material
    function deleteMaterial(index) {
        if (confirm(`Are you sure you want to delete "${materials[index].name}"?`)) {
            materials.splice(index, 1);
            markChangesDetected();
            saveMaterialsToStorage();
            loadMaterialsGrid();
            showAlert('üóëÔ∏è Material deleted successfully!', 'success');
        }
    }

    // Use material (reduce stock)
    function useMaterial(index) {
        const material = materials[index];
        const quantity = prompt(`How much of "${material.name}" did you use?\nCurrent quantity: ${material.quantity || 'Not specified'}\n\nEnter amount used:`, '1 ball');
        
        if (quantity) {
            // Update stock level based on usage
            let newStock = material.stock;
            
            // Simple logic: if it's low, mark as low, else reduce one level
            if (material.stock === 'high') {
                newStock = 'medium';
            } else if (material.stock === 'medium') {
                newStock = 'low';
            } else {
                newStock = 'low';
            }
            
            materials[index].stock = newStock;
            materials[index].lastUpdated = new Date().toISOString();
            
            // Update notes
            const usageNote = `Used ${quantity} on ${new Date().toLocaleDateString()}`;
            if (materials[index].notes) {
                materials[index].notes += `\n${usageNote}`;
            } else {
                materials[index].notes = usageNote;
            }
            
            markChangesDetected();
            saveMaterialsToStorage();
            loadMaterialsGrid();
            
            showAlert(`‚úÖ Used ${quantity} of ${material.name}`, 'success');
        }
    }

    // Show alert message
    function showAlert(message, type = 'info') {
        // Remove existing alerts
        const existingAlerts = document.querySelectorAll('.temp-alert');
        existingAlerts.forEach(alert => alert.remove());
        
        // Create new alert
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} temp-alert`;
        alertDiv.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
            <span>${message}</span>
        `;
        
        // Insert after materials section heading
        const materialsSection = document.getElementById('materials');
        const heading = materialsSection.querySelector('h2');
        materialsSection.insertBefore(alertDiv, heading.nextSibling);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.remove();
            }
        }, 5000);
    }

    // ============= REST OF THE CODE (Unchanged from previous) =============
    // [All other functions remain exactly the same]
    // Check if admin is logged in
    if (localStorage.getItem('adminLoggedIn') !== 'true') {
        window.location.href = "admin-login.html";
    }
    
    // Check session timeout (8 hours)
    const loginTime = localStorage.getItem('loginTime');
    const currentTime = Date.now();
    const eightHours = 8 * 60 * 60 * 1000;
    
    if (currentTime - loginTime > eightHours) {
        logout();
    }

    // ============= ADMIN PASSWORD MANAGEMENT =============
    const DEFAULT_ADMIN_PASSWORD = "kallakriti@123"; // Default password
    
    // Get current admin password (or use default)
    function getCurrentAdminPassword() {
        return localStorage.getItem('adminPassword') || DEFAULT_ADMIN_PASSWORD;
    }
    
    // Set new admin password
    function setAdminPassword(newPassword) {
        localStorage.setItem('adminPassword', newPassword);
    }

    // Product data structure
    let products = JSON.parse(localStorage.getItem('kallakritiProducts') || '[]');
    let complaints = JSON.parse(localStorage.getItem('kallakritiComplaints') || '[]');
    
    // Design ideas data
    let designIdeas = JSON.parse(localStorage.getItem('kallakritiDesigns') || '[]');

    // Update dashboard stats
    function updateDashboardStats() {
        document.getElementById('totalProducts').textContent = products.length;
        document.getElementById('totalComplaints').textContent = complaints.length;
        document.getElementById('materialStock').textContent = materials.length;
        
        // Calculate custom orders (products in custom category)
        const customOrders = products.filter(p => p.cat === 'custom').length;
        document.getElementById('customOrders').textContent = customOrders;
        
        checkLowStock();
    }

    // Show section
    function showSection(sectionId) {
        // Hide all sections
        document.querySelectorAll('.section').forEach(section => {
            section.classList.remove('active');
        });
        
        // Remove active class from all menu items
        document.querySelectorAll('.sidebar-menu li').forEach(item => {
            item.classList.remove('active');
        });
        
        // Show selected section
        document.getElementById(sectionId).classList.add('active');
        
        // Add active class to clicked menu item
        const menuItems = document.querySelectorAll('.sidebar-menu li');
        menuItems.forEach((item, index) => {
            const sections = ['dashboard', 'products', 'addProduct', 'complaints', 'materials', 'designs', 'password', 'settings'];
            if (sections[index] === sectionId) {
                item.classList.add('active');
            }
        });
        
        // Load data for the section
        if (sectionId === 'products') {
            loadProductsTable();
        } else if (sectionId === 'complaints') {
            loadComplaintsTable();
        } else if (sectionId === 'materials') {
            loadMaterialsGrid();
        } else if (sectionId === 'designs') {
            loadDesignIdeas();
        } else if (sectionId === 'settings') {
            loadSettingsForm();
        } else if (sectionId === 'password') {
            clearPasswordForm();
        }
        
        updateDashboardStats();
    }

    // Load products table
    function loadProductsTable() {
        const tableBody = document.getElementById('productsTableBody');
        tableBody.innerHTML = '';
        
        products.forEach((product, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><img src="${product.img}" alt="${product.name}" class="product-image" onerror="this.src='https://via.placeholder.com/60x60/ffffff/9c7c38?text=Product'"></td>
                <td>${product.name}</td>
                <td>${getCategoryName(product.cat)}</td>
                <td>‚Çπ${product.price}</td>
                <td>
                    <div class="action-buttons">
                        <button class="action-btn edit-btn" onclick="editProduct(${index})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteProduct(${index})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    // Get category name
    function getCategoryName(categoryCode) {
        const categories = {
            'flowers': 'Crochet Flowers',
            'toys': 'Crochet Toys',
            'accessories': 'Accessories',
            'baby': 'Baby Items',
            'custom': 'Custom Orders',
            'money': 'Money Bouquets'
        };
        return categories[categoryCode] || categoryCode;
    }

    // Load complaints table
    function loadComplaintsTable() {
        const tableBody = document.getElementById('complaintsTableBody');
        tableBody.innerHTML = '';
        
        complaints.forEach((complaint, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${complaint.id}</td>
                <td>${complaint.name}</td>
                <td>${complaint.phone}</td>
                <td>${complaint.type}</td>
                <td>${complaint.date}</td>
                <td>
                    <span class="status-badge status-pending">Pending</span>
                </td>
                <td>
                    <button class="action-btn edit-btn" onclick="viewComplaint(${index})">
                        <i class="fas fa-eye"></i> View
                    </button>
                    <button class="action-btn delete-btn" onclick="deleteComplaint(${index})">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    // Load design ideas
    function loadDesignIdeas() {
        const ideasList = document.getElementById('ideasList');
        ideasList.innerHTML = '';
        
        designIdeas.forEach((idea, index) => {
            const ideaItem = document.createElement('div');
            ideaItem.className = 'idea-item';
            ideaItem.innerHTML = `
                <img src="${idea.image}" alt="${idea.name}" onerror="this.src='https://via.placeholder.com/300x200/ffffff/9c7c38?text=Design'">
                <h4><i class="fas fa-lightbulb"></i> ${idea.name}</h4>
                <p><strong>Category:</strong> ${idea.category}</p>
            `;
            ideasList.appendChild(ideaItem);
        });
    }

    // Load settings form
    function loadSettingsForm() {
        const settings = JSON.parse(localStorage.getItem('kallakritiSettings') || '{}');
        document.getElementById('whatsappNumber').value = settings.whatsappNumber || "7002341920";
        document.getElementById('adminEmail').value = settings.adminEmail || "kallakriti.craft@gmail.com";
        document.getElementById('businessHours').value = settings.businessHours || "10:00 AM - 7:00 PM";
        document.getElementById('deliveryTime').value = settings.deliveryTime || "3-7 days for ready items";
    }

    // ============= PASSWORD CHANGE FUNCTIONS =============
    function checkPasswordStrength() {
        const password = document.getElementById('newPassword').value;
        const strengthBar = document.getElementById('passwordStrength');
        
        let strength = 0;
        
        // Check password length
        if (password.length >= 8) strength += 1;
        
        // Check for uppercase letters
        if (/[A-Z]/.test(password)) strength += 1;
        
        // Check for lowercase letters
        if (/[a-z]/.test(password)) strength += 1;
        
        // Check for numbers
        if (/[0-9]/.test(password)) strength += 1;
        
        // Check for special characters
        if (/[^A-Za-z0-9]/.test(password)) strength += 1;
        
        // Update strength bar
        strengthBar.className = 'strength-bar';
        if (strength <= 2) {
            strengthBar.classList.add('strength-weak');
        } else if (strength <= 4) {
            strengthBar.classList.add('strength-medium');
        } else {
            strengthBar.classList.add('strength-strong');
        }
    }

    function changeAdminPassword(event) {
        event.preventDefault();
        
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        // Get stored password
        const storedPassword = getCurrentAdminPassword();
        
        // Check if current password is correct
        if (currentPassword !== storedPassword) {
            alert('‚ùå Current password is incorrect!');
            return;
        }
        
        // Check if new password meets requirements
        if (newPassword.length < 8) {
            alert('‚ùå Password must be at least 8 characters long!');
            return;
        }
        
        if (!/[A-Z]/.test(newPassword) || !/[a-z]/.test(newPassword)) {
            alert('‚ùå Password must contain both uppercase and lowercase letters!');
            return;
        }
        
        if (!/[0-9]/.test(newPassword)) {
            alert('‚ùå Password must contain at least one number!');
            return;
        }
        
        if (!/[^A-Za-z0-9]/.test(newPassword)) {
            alert('‚ùå Password must contain at least one special character!');
            return;
        }
        
        // Check if passwords match
        if (newPassword !== confirmPassword) {
            alert('‚ùå New passwords do not match!');
            return;
        }
        
        // Update password
        setAdminPassword(newPassword);
        
        alert('‚úÖ Password changed successfully!');
        clearPasswordForm();
    }

    function clearPasswordForm() {
        document.getElementById('changePasswordForm').reset();
        document.getElementById('passwordStrength').className = 'strength-bar';
        document.getElementById('passwordStrength').style.width = '0%';
    }

    // Add new design idea
    function addNewDesign() {
        const designName = prompt('Enter design idea name:');
        if (!designName) return;
        
        const designCategory = prompt('Enter design category:', 'Home Decor');
        const designImage = prompt('Enter image URL (optional):', '');
        
        const newDesign = {
            name: designName,
            category: designCategory,
            image: designImage || 'https://via.placeholder.com/300x200/ffffff/9c7c38?text=Design'
        };
        
        designIdeas.push(newDesign);
        localStorage.setItem('kallakritiDesigns', JSON.stringify(designIdeas));
        loadDesignIdeas();
        
        alert('‚úÖ Design idea added successfully!');
    }

    // Import designs
    function importDesigns() {
        alert('üí° Feature: This would connect to Pinterest or Instagram API to import crochet design ideas.\n\nFor now, you can add designs manually using "Add New Design Idea" button.');
    }

    // Business tools functions
    function openPricingCalculator() {
        const materialCost = prompt('Enter material cost (‚Çπ):', '100');
        const timeHours = prompt('Enter time required (hours):', '2');
        const profitMargin = prompt('Enter profit margin percentage:', '50');
        
        if (materialCost && timeHours && profitMargin) {
            const laborCost = timeHours * 100; // ‚Çπ100 per hour
            const totalCost = parseFloat(materialCost) + laborCost;
            const sellingPrice = totalCost * (1 + (parseFloat(profitMargin) / 100));
            
            alert(`üí∞ Pricing Calculation:\n
Material Cost: ‚Çπ${materialCost}
Labor Cost (${timeHours} hrs): ‚Çπ${laborCost}
Total Cost: ‚Çπ${totalCost.toFixed(2)}
Profit Margin: ${profitMargin}%
Recommended Selling Price: ‚Çπ${sellingPrice.toFixed(2)}`);
        }
    }

    function viewOrderTimeline() {
        const customOrders = products.filter(p => p.cat === 'custom');
        
        if (customOrders.length === 0) {
            alert('üìÖ No custom orders found.');
            return;
        }
        
        let timeline = 'üìÖ Custom Order Timeline:\n\n';
        customOrders.forEach((order, index) => {
            timeline += `${index + 1}. ${order.name}\n`;
            timeline += `   Price: ‚Çπ${order.price}\n`;
            timeline += `   Status: In Progress\n`;
            timeline += `   Deadline: ${new Date(Date.now() + (index + 1) * 7 * 24 * 60 * 60 * 1000).toLocaleDateString()}\n\n`;
        });
        
        alert(timeline);
    }

    function viewSalesAnalytics() {
        const categoryCount = {};
        products.forEach(product => {
            categoryCount[product.cat] = (categoryCount[product.cat] || 0) + 1;
        });
        
        let analytics = 'üìä Sales Analytics:\n\n';
        analytics += `Total Products: ${products.length}\n`;
        analytics += `Categories Distribution:\n`;
        
        for (const [category, count] of Object.entries(categoryCount)) {
            const percentage = ((count / products.length) * 100).toFixed(1);
            analytics += `‚Ä¢ ${getCategoryName(category)}: ${count} products (${percentage}%)\n`;
        }
        
        // Find most expensive product
        const mostExpensive = products.reduce((max, product) => 
            product.price > max.price ? product : max, products[0] || {name: 'None', price: 0});
        
        analytics += `\nMost Expensive Product: ${mostExpensive.name} (‚Çπ${mostExpensive.price})`;
        
        alert(analytics);
    }

    function backupData() {
        const backup = {
            products: products,
            complaints: complaints,
            materials: materials,
            designIdeas: designIdeas,
            settings: JSON.parse(localStorage.getItem('kallakritiSettings') || '{}'),
            backupDate: new Date().toISOString()
        };
        
        localStorage.setItem('kallakritiBackup', JSON.stringify(backup));
        alert('‚úÖ Data backed up successfully!\n\nBackup saved in browser storage.');
    }

    // Add new product
    function addNewProduct(event) {
        event.preventDefault();
        
        const newProduct = {
            name: document.getElementById('productName').value,
            price: parseInt(document.getElementById('productPrice').value),
            cat: document.getElementById('productCategory').value,
            img: document.getElementById('productImageUrl').value || 'https://via.placeholder.com/300x300/ffffff/9c7c38?text=Kallakriti+Product'
        };
        
        products.push(newProduct);
        localStorage.setItem('kallakritiProducts', JSON.stringify(products));
        
        // Show success message
        alert('Product added successfully!');
        
        // Clear form
        clearForm();
        
        // Update customer website
        updateCustomerWebsite();
        
        // Update dashboard
        updateDashboardStats();
        
        // Reload products table
        loadProductsTable();
    }

    // Edit product
    function editProduct(index) {
        const product = products[index];
        
        // Fill form with product data
        document.getElementById('productName').value = product.name;
        document.getElementById('productPrice').value = product.price;
        document.getElementById('productCategory').value = product.cat;
        document.getElementById('productImageUrl').value = product.img;
        updateImagePreview();
        
        // Change form to edit mode
        const form = document.getElementById('addProductForm');
        form.onsubmit = function(e) {
            e.preventDefault();
            saveProductEdit(index);
        };
        
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Product';
        
        // Show edit section
        showSection('addProduct');
    }

    // Save product edit
    function saveProductEdit(index) {
        products[index] = {
            name: document.getElementById('productName').value,
            price: parseInt(document.getElementById('productPrice').value),
            cat: document.getElementById('productCategory').value,
            img: document.getElementById('productImageUrl').value || 'https://via.placeholder.com/300x300/ffffff/9c7c38?text=Kallakriti+Product'
        };
        
        localStorage.setItem('kallakritiProducts', JSON.stringify(products));
        
        alert('Product updated successfully!');
        clearForm();
        showSection('products');
        loadProductsTable();
        
        // Update customer website
        updateCustomerWebsite();
    }

    // Delete product
    function deleteProduct(index) {
        if (confirm('Are you sure you want to delete this product?')) {
            products.splice(index, 1);
            localStorage.setItem('kallakritiProducts', JSON.stringify(products));
            loadProductsTable();
            updateDashboardStats();
            
            // Update customer website
            updateCustomerWebsite();
        }
    }

    // View complaint details
    function viewComplaint(index) {
        const complaint = complaints[index];
        const details = `
            Complaint ID: ${complaint.id}
            Name: ${complaint.name}
            Email: ${complaint.email}
            Phone: ${complaint.phone}
            Type: ${complaint.type}
            Date: ${complaint.date}
            
            Details:
            ${complaint.details}
        `;
        alert(details);
    }

    // Delete complaint
    function deleteComplaint(index) {
        if (confirm('Are you sure you want to delete this complaint?')) {
            complaints.splice(index, 1);
            localStorage.setItem('kallakritiComplaints', JSON.stringify(complaints));
            loadComplaintsTable();
            updateDashboardStats();
        }
    }

    // Clear form
    function clearForm() {
        document.getElementById('addProductForm').reset();
        document.getElementById('previewImage').style.display = 'none';
        document.querySelector('#imagePreview span').style.display = 'block';
        
        // Reset form to add mode
        const form = document.getElementById('addProductForm');
        form.onsubmit = function(e) {
            e.preventDefault();
            addNewProduct(e);
        };
        
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Add Product';
    }

    // Update image preview
    document.getElementById('productImageUrl').addEventListener('input', updateImagePreview);
    
    function updateImagePreview() {
        const url = document.getElementById('productImageUrl').value;
        const preview = document.getElementById('previewImage');
        const placeholder = document.querySelector('#imagePreview span');
        
        if (url) {
            preview.src = url;
            preview.style.display = 'block';
            placeholder.style.display = 'none';
        } else {
            preview.style.display = 'none';
            placeholder.style.display = 'block';
        }
    }

    // Update customer website
    function updateCustomerWebsite() {
        // Save products to localStorage (customer website reads from here)
        localStorage.setItem('kallakritiProducts', JSON.stringify(products));
        
        console.log('‚úÖ Customer website updated with new products!');
        alert('‚úÖ Changes saved! Customer website has been updated.');
    }

    // Save settings
    function saveSettings() {
        const whatsappNumber = document.getElementById('whatsappNumber').value;
        const adminEmail = document.getElementById('adminEmail').value;
        const businessHours = document.getElementById('businessHours').value;
        const deliveryTime = document.getElementById('deliveryTime').value;
        
        if (!whatsappNumber || !adminEmail) {
            alert('‚ùå WhatsApp Number and Email are required!');
            return;
        }
        
        // Save settings to localStorage
        const settings = {
            whatsappNumber: whatsappNumber,
            adminEmail: adminEmail,
            businessHours: businessHours,
            deliveryTime: deliveryTime,
            lastUpdated: new Date().toISOString()
        };
        localStorage.setItem('kallakritiSettings', JSON.stringify(settings));
        
        alert('‚úÖ Settings saved successfully!\n\nCustomer website will update automatically.');
    }

    // Reset settings to default
    function resetSettings() {
        if (confirm('Reset to default settings?')) {
            const defaultSettings = {
                whatsappNumber: "7002341920",
                adminEmail: "kallakriti.craft@gmail.com",
                businessHours: "10:00 AM - 7:00 PM",
                deliveryTime: "3-7 days for ready items"
            };
            localStorage.setItem('kallakritiSettings', JSON.stringify(defaultSettings));
            loadSettingsForm();
            alert('‚úÖ Settings reset to default!');
        }
    }

    // Logout
    function logout() {
        // Save any unsaved changes before logout
        if (changeDetected) {
            if (confirm('You have unsaved changes in Materials. Save before logout?')) {
                saveMaterialsData();
            }
        }
        
        localStorage.removeItem('adminLoggedIn');
        localStorage.removeItem('loginTime');
        window.location.href = "admin-login.html";
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', function() {
        initializeMaterials();
        updateDashboardStats();
        loadProductsTable();
        loadComplaintsTable();
        loadMaterialsGrid();
        loadDesignIdeas();
        loadSettingsForm();
        
        // Auto logout after 8 hours
        setInterval(() => {
            const loginTime = localStorage.getItem('loginTime');
            const currentTime = Date.now();
            if (currentTime - loginTime > eightHours) {
                logout();
            }
        }, 60000); // Check every minute
        
        // Sync color picker with text input
        const colorPicker = document.getElementById('materialColor');
        const colorText = document.getElementById('materialColorText');
        
        colorPicker.addEventListener('input', () => {
            colorText.value = colorPicker.value;
        });
        
        colorText.addEventListener('input', () => {
            if (colorText.value.match(/^#[0-9A-F]{6}$/i)) {
                colorPicker.value = colorText.value;
            }
        });
        
        // Auto-save every 30 seconds if changes detected
        setInterval(() => {
            if (changeDetected && autoSaveEnabled) {
                saveMaterialsToStorage();
            }
        }, 30000);
        
        // Warn before leaving page with unsaved changes
        window.addEventListener('beforeunload', function(e) {
            if (changeDetected) {
                e.preventDefault();
                e.returnValue = 'You have unsaved changes in Materials. Are you sure you want to leave?';
            }
        });
    });
    </script>
</body>
</html>
